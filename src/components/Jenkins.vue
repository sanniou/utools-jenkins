<template>
  <div>
    <el-container v-loading="loading">
      <el-header>
        <el-row :gutter="20" align="middle">
          <el-col :span="16">
            <el-input
              v-model="searchQuery"
              placeholder="搜索 Job"
              clearable
              @input="debouncedFilterJobs"
              class="input-with-select"
            >
              <template #prepend>
                <el-select
                  v-model="selectedConfigId"
                  placeholder="实例"
                  @change="handleConfigChange"
                  style="width: 130px"
                >
                  <el-option
                    v-for="config in allConfigs"
                    :key="config._id"
                    :label="config.data.url"
                    :value="config._id"
                  />
                </el-select>
              </template>
            </el-input>
          </el-col>
          <el-col :span="8" style="text-align: right">
            <el-tooltip content="刷新列表" placement="top">
              <el-button circle @click="refreshAllJobs"
                ><el-icon><Refresh /></el-icon
              ></el-button>
            </el-tooltip>
            <el-tooltip content="设置" placement="top">
              <el-button circle @click="goToConfig"
                ><el-icon><Setting /></el-icon
              ></el-button>
            </el-tooltip>
          </el-col>
        </el-row>
      </el-header>
      <el-main>
        <el-table
          v-if="filteredJobs.length > 0"
          :data="filteredJobs"
          style="width: 100%"
          row-key="name"
          stripe
          border
        >
          <el-table-column
            prop="name"
            label="Name"
            min-width="150"
            sortable
            show-overflow-tooltip
          >
            <template #default="{ row }">
              <span
                class="link-style"
                @click="openJenkinsJobUrl(row.name)"
                v-html="highlightMatchedText(row.name, searchQuery)"
              ></span>
            </template>
          </el-table-column>
          <el-table-column label="最近一次 Job" min-width="60">
            <template #default="{ row }">
              <el-tag
                v-if="row.lastBuild"
                :type="
                  getBuildStatusType(
                    row.lastBuild.result,
                    row.lastBuild.building
                  )
                "
                class="link-style"
                @click="openJenkinsBuildUrl(row.name, row.lastBuild.number)"
              >
                {{
                  getBuildStatusText(
                    row.lastBuild.result,
                    row.lastBuild.building
                  )
                }}
              </el-tag>
              <span v-else>无构建历史</span>
            </template>
          </el-table-column>
          <el-table-column label="Change Message" min-width="220">
            <template #default="{ row }">
              <el-tooltip
                :raw-content="true"
                :content="getFullChangeSets(row.lastBuild?.changeSets)"
                placement="top"
              >
                <span
                  v-html="getTruncatedChangeSets(row.lastBuild?.changeSets)"
                ></span>
              </el-tooltip>
            </template>
          </el-table-column>
          <el-table-column
            label="Time"
            sortable
            sort-by="lastBuild.timestamp"
            min-width="84"
          >
            <template #default="{ row }">
              {{ formatTimestamp(row.lastBuild?.timestamp) }}
            </template>
          </el-table-column>
          <el-table-column label="Action" min-width="90">
            <template #default="{ row }">
              <el-button
                circle
                @click="refreshJob(row.name)"
                :loading="jobLoading[row.name]"
              >
                <el-icon><Refresh /></el-icon>
              </el-button>
              <el-button circle @click="openBuildMenu(row)">
                <el-icon><Menu /></el-icon>
              </el-button>
            </template>
          </el-table-column>
        </el-table>
        <el-empty v-else description="暂无 Job，请检查配置或刷新" />
      </el-main>
    </el-container>

    <!-- 1. 将 el-dialog 替换为 el-drawer，以抽屉形式展示，交互更流畅 -->
    <el-drawer
      v-model="buildMenuVisible"
      direction="rtl"
      :show-close="false"
      size="80%"
      :destroy-on-close="true"
      @open="startPolling"
      @close="stopPolling"
    >
      <!-- 2. 使用 #header 插槽自定义头部，增强交互性和视觉效果 -->
      <template #header>
        <h4 class="drawer-title">
          构建菜单 -
          <span class="link-style" @click="openJenkinsJobUrl(selectedJob.name)">
            {{ selectedJob?.name }}</span
          >
        </h4>
      </template>
      <!-- 1. 使用 el-scrollbar 替代 div，以获得统一样式的滚动条和更优的布局 -->
      <el-scrollbar max-height="60vh" class="build-table-container">
        <el-table :data="displayedBuilds" style="width: 100%" stripe border>
          <el-table-column prop="number" label="No" min-width="40">
            <template #default="{ row }">
              <span
                class="link-style"
                @click="openJenkinsBuildUrl(selectedJob.name, row.number)"
                >{{ row.number }}</span
              >
            </template>
          </el-table-column>
          <el-table-column
            prop="url"
            label="URL"
            min-width="150"
            show-overflow-tooltip
          >
            <template #default="{ row }">
              <el-link :href="row.url" target="_blank">{{ row.url }}</el-link>
            </template>
          </el-table-column>
          <el-table-column label="Progress" min-width="80">
            <template #default="{ row }">
              <div
                v-if="row.building"
                style="display: flex; align-items: center"
              >
                <el-progress
                  :indeterminate="true"
                  style="width: 60px; margin-right: 8px"
                />
                <span>进行中...</span>
              </div>
              <span v-else>-</span>
            </template>
          </el-table-column>
          <el-table-column label="Result" min-width="60" align="center">
            <template #default="{ row }">
              <el-tooltip
                :content="getBuildStatusText(row.result, row.building)"
                placement="top"
              >
                <span style="font-size: 1em">{{
                  getBuildStatusIcon(row.result, row.building)
                }}</span>
              </el-tooltip>
            </template>
          </el-table-column>
          <el-table-column prop="timestamp" label="Build Time" min-width="120">
            <template #default="{ row }">
              {{ formatTimestamp(row.timestamp) }}
            </template>
          </el-table-column>
          <el-table-column label="操作" min-width="70">
            <template #default="{ row }">
              <el-button
                circle
                @click="refreshBuild(selectedJob.name, row.number)"
                :loading="buildLoading[`${selectedJob.name}-${row.number}`]"
              >
                <el-icon><Refresh /></el-icon>
              </el-button>
            </template>
          </el-table-column>
        </el-table>
        <div class="build-table-footer">
          <el-button
            v-if="selectedJobBuilds.length > 10"
            text
            @click="showAllBuilds = !showAllBuilds"
          >
            {{ showAllBuilds ? "收起" : "展开全部" }}
          </el-button>
        </div>
      </el-scrollbar>
      <template #footer>
        <span class="dialog-footer">
          <el-button type="primary" @click="handleBuildClick"
            >立即构建</el-button
          >
        </span>
      </template>
    </el-drawer>

    <!-- 新增的参数输入对话框 -->
    <el-dialog
      v-model="buildParamsVisible"
      :title="`构建 Job - ${selectedJob?.name}`"
      width="40%"
      :lock-scroll="false"
      :destroy-on-close="true"
    >
      <el-form :model="buildParameters" label-width="auto">
        <el-form-item
          v-for="param in jobParameterDefinitions"
          :key="param.name"
          :label="param.name"
        >
          <template v-if="param.type === 'ChoiceParameterDefinition'">
            <el-select
              v-model="buildParameters[param.name]"
              placeholder="请选择"
            >
              <el-option
                v-for="choice in param.choices"
                :key="choice"
                :label="choice"
                :value="choice"
              />
            </el-select>
          </template>
          <template v-else>
            <!-- 不支持的参数类型，显示为只读文本或提示 -->
            <el-input
              v-model="buildParameters[param.name]"
              :placeholder="`不支持的参数类型: ${param.type}`"
              disabled
            />
          </template>
        </el-form-item>
      </el-form>
      <template #footer>
        <span class="dialog-footer">
          <el-button @click="buildParamsVisible = false">取消</el-button>
          <el-button type="primary" @click="confirmBuildWithParams"
            >确定构建</el-button
          >
        </span>
      </template>
    </el-dialog>
  </div>
</template>

<script setup>
import { ref, onMounted, computed, watch } from "vue";
import { ElMessage, ElIcon } from "element-plus";
import { Refresh, Menu, Setting } from "@element-plus/icons-vue";
import moment from "moment";
import { createJenkinsApi } from "../api/jenkins.js";
import { getBuildStatusType, getBuildStatusText } from "../js/jenkins-utils.js";
import utools_dev from "../js/utools_mock";

let utools = window.utools ? window.utools : utools_dev;

// --- 辅助函数 ---
function formatTimestamp(ts) {
  if (!ts) return "-";
  const now = moment();
  const target = moment(ts);

  const seconds = now.diff(target, "seconds");
  const minutes = now.diff(target, "minutes");
  const hours = now.diff(target, "hours");
  const days = now.diff(target, "days");

  if (seconds < 60) {
    return "刚刚";
  } else if (minutes < 60) {
    return `${minutes}m ago`;
  } else if (hours < 24) {
    return `${hours}h ago`;
  } else if (days < 30) {
    return `${days}d ago`;
  } else {
    // 超过30天，显示完整的年-月-日
    return moment(ts).format("YYYY-MM-DD");
  }
}

function highlightMatchedText(text, query) {
  if (!query) return text;
  const keywords = query
    .toLowerCase()
    .split(" ")
    .filter((k) => k);
  let highlightedText = text;
  keywords.forEach((keyword) => {
    const regex = new RegExp(`(${keyword})`, "gi");
    highlightedText = highlightedText.replace(
      regex,
      '<span class="highlight">$1</span>'
    );
  });
  return highlightedText;
}

function debounce(func, delay) {
  let timeout;
  return function (...args) {
    const context = this;
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(context, args), delay);
  };
}

function getBuildStatusIcon(result, building) {
  if (building) return "⏳";
  if (result === "SUCCESS") return "✅";
  if (result === "FAILURE") return "❌";
  if (result === "ABORTED") return "🛑";
  return "❔";
}

function getFullChangeSets(changeSets) {
  if (!changeSets || changeSets.length === 0) {
    return "无变更信息";
  }

  let messages = [];
  changeSets.forEach((changeSet) => {
    if (changeSet.items && changeSet.items.length > 0) {
      changeSet.items.forEach((item) => {
        const author = item.authorEmail ? `(${item.authorEmail})` : "";
        const msg = item.msg ? item.msg : "无提交信息";
        messages.push(`${author} ${msg}`);
      });
    }
  });

  if (messages.length === 0) {
    return "无变更信息";
  }

  return messages.join("<br />");
}

function getTruncatedChangeSets(changeSets) {
  const fullMessagesHtml = getFullChangeSets(changeSets);
  // Convert HTML <br /> to \n for line splitting
  const messagesArray = fullMessagesHtml.split("<br />");

  if (messagesArray.length <= 3) {
    return fullMessagesHtml; // No truncation needed
  }

  const truncatedMessages = messagesArray.slice(0, 3);
  truncatedMessages[2] += "..."; // Add ellipsis to the third line
  return truncatedMessages.join("<br />");
}

function openJenkinsJobUrl(jobName) {
  if (currentJenkinsConfig.value && currentJenkinsConfig.value.url) {
    let baseUrl = currentJenkinsConfig.value.url;
    if (!baseUrl.startsWith("http://") && !baseUrl.startsWith("https://")) {
      baseUrl = `http://${baseUrl}`;
    }
    baseUrl = baseUrl.endsWith("/") ? baseUrl : `${baseUrl}/`;
    const jobUrl = `${baseUrl}job/${jobName}/`;
    console.log(jobUrl);
    utools.shellOpenExternal(jobUrl);
  } else {
    ElMessage.error("Jenkins 配置无效，无法打开链接。");
  }
}

function openJenkinsBuildUrl(jobName, buildNumber) {
  if (currentJenkinsConfig.value && currentJenkinsConfig.value.url) {
    let baseUrl = currentJenkinsConfig.value.url;
    if (!baseUrl.startsWith("http://") && !baseUrl.startsWith("https://")) {
      baseUrl = `http://${baseUrl}`;
    }
    baseUrl = baseUrl.endsWith("/") ? baseUrl : `${baseUrl}/`;
    const buildUrl = `${baseUrl}job/${jobName}/${buildNumber}/`;
    utools.shellOpenExternal(buildUrl);
  } else {
    ElMessage.error("Jenkins 配置无效，无法打开链接。");
  }
}

// --- 响应式状态 ---
const loading = ref(true);
const jobLoading = ref({});
const buildLoading = ref({});
const allConfigs = ref([]); // 新增：存储所有配置
const currentJenkinsConfig = ref(null);
const allJobs = ref([]);
const searchQuery = ref("");
const buildMenuVisible = ref(false);
const selectedJob = ref(null);
const selectedJobBuilds = ref([]);
const showAllBuilds = ref(false);

const selectedConfigId = ref(null); // 新增：当前选中的配置ID
const buildParamsVisible = ref(false); // 控制参数输入对话框的显示
const jobParameterDefinitions = ref([]); // 存储 Job 的参数定义
const buildParameters = ref({}); // 存储用户输入的参数值

const activePollingBuilds = ref(new Set()); // Stores build numbers that are currently being polled
let pollingInterval = null; // To store the interval ID

const filteredJobs = computed(() => {
  if (!searchQuery.value) {
    return allJobs.value;
  }
  // Multi-keyword search (AND logic)
  const keywords = searchQuery.value
    .toLowerCase()
    .split(" ")
    .filter((k) => k);
  return allJobs.value.filter((job) => {
    const jobName = job.name.toLowerCase();
    return keywords.every((keyword) => jobName.includes(keyword));
  });
});

const displayedBuilds = computed(() => {
  if (showAllBuilds.value) {
    return selectedJobBuilds.value;
  }
  return selectedJobBuilds.value.slice(0, 10);
});

let jenkinsApi = null;

// --- 轮询相关函数 ---
function startPolling() {
  // 确保只有一个轮询在运行
  if (pollingInterval) {
    clearInterval(pollingInterval);
  }
  pollingInterval = setInterval(async () => {
    if (activePollingBuilds.value.size === 0) {
      stopPolling();
      return;
    }
    for (const buildKey of activePollingBuilds.value) {
      const [jobName, buildNumber] = buildKey.split("-");
      await refreshBuild(jobName, parseInt(buildNumber));
    }
  }, 5000); // 每 5 秒轮询一次
}

function stopPolling() {
  if (pollingInterval) {
    clearInterval(pollingInterval);
    pollingInterval = null;
  }
  activePollingBuilds.value.clear(); // 清空正在轮询的构建
}

// --- 生命周期钩子 ---
onMounted(() => {
  allConfigs.value = utools.db.allDocs("jenkins");
  if (allConfigs.value && allConfigs.value.length > 0) {
    // 默认选中第一个
    selectedConfigId.value = allConfigs.value[0]._id;
    currentJenkinsConfig.value = allConfigs.value.find(
      (c) => c._id === selectedConfigId.value
    )?.data;
    initJenkins();
  } else {
    loading.value = false;
    ElMessage({
      message: "未找到 Jenkins 配置，请先进行配置。",
      type: "error",
      duration: 0,
      showClose: true,
      onClose: () => utools.redirect("jenkins-set", ""),
    });
  }
});

// --- 方法 ---
function goToConfig() {
  utools.redirect("jenkins-set", "");
}

// 新增：处理配置切换的函数
function handleConfigChange(configId) {
  const selectedConf = allConfigs.value.find((c) => c._id === configId);
  if (selectedConf) {
    currentJenkinsConfig.value = selectedConf.data;
    // 清空旧数据并重新初始化
    allJobs.value = [];
    initJenkins();
  }
}
async function initJenkins() {
  if (!currentJenkinsConfig.value || !currentJenkinsConfig.value.url) {
    ElMessage.error("Jenkins 配置无效，请先进行配置");
    loading.value = false;
    return;
  }

  await withLoading(async () => {
    const api = createJenkinsApi(currentJenkinsConfig.value);
    const crumbData = await api.getCrumb();
    if (crumbData) {
      currentJenkinsConfig.value.crumb = crumbData.crumb;
      jenkinsApi = createJenkinsApi(currentJenkinsConfig.value);
    } else {
      jenkinsApi = api;
    }
    await refreshAllJobs();
  }, "初始化 Jenkins 失败");
}

async function refreshAllJobs() {
  await withLoading(async () => {
    const jobsData = await jenkinsApi.getJobsWithLatestBuild();
    allJobs.value = jobsData.jobs.sort(
      (a, b) => (b.lastBuild?.timestamp || 0) - (a.lastBuild?.timestamp || 0)
    );
  }, "刷新 Job 列表失败");
}

async function refreshJob(jobName) {
  jobLoading.value[jobName] = true;
  try {
    // 使用指定的 tree 参数来获取更详细的 Job 信息，包括 changeSets 和 culprits
    const customTree =
      "name,url,color,lastBuild[changeSets[items[*]],culprits[fullName],displayName,number,url,result,building,duration,timestamp]";
    const jobData = await jenkinsApi.getJob(jobName, customTree);
    const index = allJobs.value.findIndex((job) => job.name === jobName);
    if (index !== -1) {
      // 找到对应的 Job 并更新其数据
      allJobs.value[index] = { ...allJobs.value[index], ...jobData };
    }
  } catch (error) {
    console.error(`刷新 Job ${jobName} 失败:`, error);
    ElMessage.error(`刷新 Job ${jobName} 失败: ${error.message || "未知错误"}`);
  } finally {
    jobLoading.value[jobName] = false;
  }
}

async function openBuildMenu(job) {
  selectedJob.value = job;
  buildMenuVisible.value = true;
  showAllBuilds.value = false; // 重置状态
  await withLoading(async () => {
    const jobData = await jenkinsApi.getJob(job.name);
    selectedJobBuilds.value = jobData.builds || [];

    // 将当前正在进行的构建添加到轮询列表
    selectedJobBuilds.value.forEach((build) => {
      if (build.building) {
        activePollingBuilds.value.add(`${job.name}-${build.number}`);
      }
    });

    // 从 property 中获取参数定义
    const paramsProperty = jobData.property.find(
      (p) => p._class === "hudson.model.ParametersDefinitionProperty"
    );
    // 过滤只显示 ChoiceParameterDefinition 类型的参数
    jobParameterDefinitions.value = paramsProperty
      ? paramsProperty.parameterDefinitions.filter(
          (param) => param.type === "ChoiceParameterDefinition"
        )
      : [];

    // 初始化参数值
    buildParameters.value = {};
    jobParameterDefinitions.value.forEach((param) => {
      if (
        param.type === "ChoiceParameterDefinition" &&
        param.choices &&
        param.choices.length > 0
      ) {
        buildParameters.value[param.name] = param.choices[0]; // 默认选择第一个
      } else if (param.defaultParameterValue) {
        buildParameters.value[param.name] = param.defaultParameterValue.value;
      } else {
        buildParameters.value[param.name] = ""; // 默认空字符串
      }
    });
  }, `获取 Job ${job.name} 的构建历史和参数失败`);
}

// 新增一个处理“立即构建”按钮点击的方法
function handleBuildClick() {
  if (jobParameterDefinitions.value.length > 0) {
    buildParamsVisible.value = true; // 显示参数输入对话框
  } else {
    buildJob(); // 直接构建
  }
}

// 修改 buildJob 方法，使其接收参数
async function buildJob(params = {}) {
  if (!selectedJob.value || !jenkinsApi) return;

  await withLoading(async () => {
    // 触发构建，并获取 queueId
    const queueItem = await jenkinsApi.buildJob(selectedJob.value.name, params);
    ElMessage.success(`构建已触发，队列 ID: ${queueItem.queueId}`);

    // 立即刷新主列表的 Job 状态，确保 lastBuild 信息是最新的
    await refreshJob(selectedJob.value.name);

    // 轮询队列，直到获取到 buildNumber
    const newBuild = await pollQueueForBuild(
      queueItem.queueId,
      selectedJob.value.name
    );
    if (newBuild) {
      // 将新构建添加到构建菜单的顶部
      selectedJobBuilds.value.unshift(newBuild);
      // 如果新构建正在进行中，添加到轮询列表
      if (newBuild.building) {
        activePollingBuilds.value.add(
          `${selectedJob.value.name}-${newBuild.number}`
        );
      }
      ElMessage.success(`新构建 #${newBuild.number} 已添加到列表。`);
    } else {
      ElMessage.warning(`未能获取到新构建的详细信息。`);
    }
  }, `构建 Job ${selectedJob.value.name} 失败`);
}

// 新增轮询队列的方法
async function pollQueueForBuild(queueId, jobName) {
  let buildNumber = null;
  let attempts = 0;
  const maxAttempts = 30; // 尝试 30 次，每次间隔 2 秒，总共 1 分钟
  const delay = 2000; // 2 秒

  while (attempts < maxAttempts && buildNumber === null) {
    try {
      const queueItem = await jenkinsApi.getQueueItem(queueId);
      if (queueItem && queueItem.executable && queueItem.executable.number) {
        buildNumber = queueItem.executable.number;
        // 获取到 buildNumber 后，立即获取该构建的详细信息
        const buildData = await jenkinsApi.getBuild(jobName, buildNumber);
        return buildData;
      }
    } catch (error) {
      console.error(`轮询队列 ${queueId} 失败:`, error);
      // 即使失败也继续尝试，可能是临时网络问题
    }
    attempts++;
    await new Promise((resolve) => setTimeout(resolve, delay));
  }
  return null;
}

// 新增一个确认带参数构建的方法
async function confirmBuildWithParams() {
  buildParamsVisible.value = false; // 关闭参数输入对话框

  const paramsToBuild = {};
  jobParameterDefinitions.value.forEach((paramDef) => {
    // 只有非 WHideParameterDefinition 类型的参数才会被传递
    if (paramDef.type !== "WHideParameterDefinition") {
      paramsToBuild[paramDef.name] = buildParameters.value[paramDef.name];
    }
  });

  await buildJob(paramsToBuild); // 调用 buildJob 并传入过滤后的参数
}

async function refreshBuild(jobName, buildNumber) {
  buildLoading.value[`${jobName}-${buildNumber}`] = true;
  try {
    const buildData = await jenkinsApi.getBuild(jobName, buildNumber);
    const buildIndex = selectedJobBuilds.value.findIndex(
      (build) => build.number === buildNumber
    );
    if (buildIndex !== -1) {
      selectedJobBuilds.value[buildIndex] = {
        ...selectedJobBuilds.value[buildIndex],
        ...buildData,
      };
      // 如果构建不再进行中，从轮询列表中移除并刷新主列表 Job 状态，发送通知
      if (!buildData.building) {
        activePollingBuilds.value.delete(`${jobName}-${buildNumber}`);
        await refreshJob(jobName); // 刷新主列表的 Job 状态
        utools.showNotification(
          `Job: ${jobName} #${buildNumber} 构建完成，结果: ${getBuildStatusText(
            buildData.result,
            buildData.building
          )}`
        );
      }
    }
  } catch (error) {
    console.error(`刷新构建 #${buildNumber} 失败:`, error);
    ElMessage.error(
      `刷新构建 #${buildNumber} 失败: ${error.message || "未知错误"}`
    );
  } finally {
    buildLoading.value[`${jobName}-${buildNumber}`] = false;
  }
}

async function withLoading(fn, errorMessage = "操作失败") {
  loading.value = true;
  try {
    await fn();
  } catch (error) {
    console.error(errorMessage + ":", error);
    ElMessage.error(`${errorMessage}: ${error.message || "未知错误"}`);
  } finally {
    loading.value = false;
  }
}

// Debounced filter function
const debouncedFilterJobs = debounce(() => {
  // The actual filtering logic is now in the computed property `filteredJobs`
  // This function just triggers the re-evaluation of `filteredJobs`
}, 300);
</script>
"""

<style scoped>
.el-header {
  padding-top: 20px;
}
.dialog-footer {
  display: flex;
  justify-content: flex-end; /* 让按钮靠右 */
  width: 100%;
}

.build-table-container::-webkit-scrollbar {
  display: none; /* Chrome, Safari, Opera */
}
.build-table-container {
  -ms-overflow-style: none; /* IE and Edge */
  scrollbar-width: none; /* Firefox */
}

.build-table-footer {
  text-align: center; /* 居中 */
  padding-top: 10px; /* 与表格的间距 */
}

.el-drawer__body {
  padding: 5px;
}

.drawer-title {
  margin: 0; /* 移除 h4 的默认 margin */
  font-size: 1rem; /* 保持与默认标题大小一致 */
  color: var(--el-text-color-primary); /* 保持与默认标题颜色一致 */
}

/* 3. 为抽屉的 Header 添加下边框和内边距，提升视觉层次感 */
:deep(.el-drawer__header) {
  margin-bottom: 10px;
  border-bottom: 1px solid var(--el-border-color-lighter);
}
.highlight {
  background-color: yellow;
  font-weight: bold;
}

.link-style:hover {
  text-decoration: underline;
}

.input-with-select :deep(.el-input-group__prepend) {
  background-color: var(--el-fill-color-blank);
}
</style>

<style>
/* 1. 始终为滚动条轨道预留空间，防止布局跳动 */
html {
  scrollbar-gutter: stable;
  -ms-overflow-style: none; /* IE */
  scrollbar-width: none; /* Firefox */
}
/* 2. 视觉上隐藏主滚动条 */
body::-webkit-scrollbar {
  display: none; /* Chrome, Safari, Edge */
}
</style>
